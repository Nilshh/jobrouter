document.getElementById('scrapeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const query = document.getElementById('query').value;
    const location = document.getElementById('location').value;
    const statusDiv = document.getElementById('scrapeStatus');
    
    statusDiv.innerHTML = '<div class="alert alert-info"><span class="loading"></span> Scraping läuft...</div>';
    
    try {
        const response = await fetch('/api/scrape', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query, location })
        });
        
        const data = await response.json();
        
        if (data.success) {
            statusDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
            loadJobs();
        } else {
            statusDiv.innerHTML = `<div class="alert alert-danger">Fehler: ${data.message}</div>`;
        }
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-danger">Fehler: ${error}</div>`;
    }
});

async function loadJobs() {
    try {
        const response = await fetch('/api/jobs?limit=50');
        const data = await response.json();
        
        if (data.success && data.jobs.length > 0) {
            const table = `
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Datum</th>
                            <th>Plattform</th>
                            <th>Titel</th>
                            <th>Unternehmen</th>
                            <th>Standort</th>
                            <th>Link</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.jobs.map(job => `
                            <tr>
                                <td>${job.Datum}</td>
                                <td><span class="badge bg-info platform-badge">${job.Plattform}</span></td>
                                <td>${job.Titel}</td>
                                <td>${job.Unternehmen}</td>
                                <td>${job.Standort}</td>
                                <td><a href="${job.Link}" target="_blank" class="job-link">Zur Stelle →</a></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('jobsContainer').innerHTML = table;
        } else {
            document.getElementById('jobsContainer').innerHTML = '<p class="alert alert-warning">Keine Jobs gefunden</p>';
        }
    } catch (error) {
        document.getElementById('jobsContainer').innerHTML = `<p class="alert alert-danger">Fehler beim Laden: ${error}</p>`;
    }
}

// Lade Jobs beim Setenstart
document.addEventListener('DOMContentLoaded', loadJobs);
